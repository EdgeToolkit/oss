#- name: Remove gitlab-runner
#  script: |
#    gitlab-runner.py delete \
#    --config {{GITLAB_RUNNER_CONFIG_FILE}} \
#    --hostname {{ansible_ssh_host}} 
#  args:
#    executable: python3
#  delegate_to: localhost

---
- hosts: builder,runner,deployer
  tasks:
  - name: Unregister gitlab-runner
    gitlab_runner_unregister:
      hostname: "{{ansible_ssh_host}}"
      type: "{{item}}"
      config: "{{GITLAB_RUNNER_CONFIG_FILE}}"
      db: "{{GITLAB_RUNNER_REGISTER_DB}}"
    delegate_to: localhost
    with_list: "{{group_names}}"

#  - debug: msg="hostname {{ansible_ssh_host}}  {{item}}"
#    with_list: "{{group_names}}"
